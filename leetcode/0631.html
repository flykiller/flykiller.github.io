<!DOCTYPE html>
<html lang="en"><head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Leetcode 0631 Design Excel Sum Formula | Dmitry Babichev’s webpage</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Leetcode 0631 Design Excel Sum Formula" />
<meta name="author" content="Dmitry Babichev" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Problem statement" />
<meta property="og:description" content="Problem statement" />
<meta property="og:site_name" content="Dmitry Babichev’s webpage" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-16T21:24:19+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Leetcode 0631 Design Excel Sum Formula" />
<script type="application/ld+json">
{"url":"/leetcode/0631.html","@type":"BlogPosting","headline":"Leetcode 0631 Design Excel Sum Formula","dateModified":"2022-01-16T21:24:19+03:00","datePublished":"2022-01-16T21:24:19+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"/leetcode/0631.html"},"author":{"@type":"Person","name":"Dmitry Babichev"},"description":"Problem statement","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Dmitry Babichev's webpage" />
    






  
  
</head>

    
    <!-- for mathjax support -->
    
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Dmitry Babichev&#39;s webpage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/leetcode%20problems/">Leetcode problems</a><a class="page-link" href="/codeforces%20problems/">Codeforces problems</a><a class="page-link" href="/coding%20ideas/">Patterns</a><a class="page-link" href="/performance%20tricks/">Speed up</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <span>[
  
    
    <a href="/tag/graph"><code class="highligher-rouge"><nobr>graph</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/topological sort"><code class="highligher-rouge"><nobr>topological sort</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/recursion"><code class="highligher-rouge"><nobr>recursion</nobr></code>&nbsp;</a>
  
]</span>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Leetcode 0631 Design Excel Sum Formula</h1>
    <p class="post-meta"><time class="dt-published" datetime="2022-01-16T21:24:19+03:00" itemprop="datePublished">
        Jan 16, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h4 id="problem-statement">Problem statement</h4>

<p><a href="https://leetcode.com/problems/design-excel-sum-formula/"> <font color="blue">https://leetcode.com/problems/design-excel-sum-formula/</font></a></p>

<h4 id="solution">Solution</h4>
<p>The idea is that our Excel table actually is DAG, that is graph without cycles.</p>

<ol>
  <li>We initialize our <code class="language-plaintext highlighter-rouge">matrix</code> as 2D array of dictionaries: for each cell we have value <code class="language-plaintext highlighter-rouge">val</code> and edges <code class="language-plaintext highlighter-rouge">E</code>: our connections with other cells with weights (we need weights, because we can have something like <code class="language-plaintext highlighter-rouge">A3 = 2A2 + 3B1</code>). Time complexity is <code class="language-plaintext highlighter-rouge">O(WH)</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">set(r, c, v)</code> function just put value <code class="language-plaintext highlighter-rouge">v</code> to corresponding cell and make connections empty, it is important: “this sum formula should exist until this cell is overlapped by another value or another sum formula”. Time complexity is <code class="language-plaintext highlighter-rouge">O(1)</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">get(r, c)</code>. Here we need to check if corresponding edges <code class="language-plaintext highlighter-rouge">E</code> for this cell is empty. If it is, it means that we reached leaf in our tree and we just return value. If edges are not empty, we need to recursively call our <code class="language-plaintext highlighter-rouge">get</code> function for all children and sum it. Time complexity is potentially <code class="language-plaintext highlighter-rouge">O(W^2H^2)</code>, because we can have fully one-directional connected graph. More precisely, it is <code class="language-plaintext highlighter-rouge">O(WHE)</code>, where <code class="language-plaintext highlighter-rouge">E</code> is current number of edges in our graph.</li>
  <li><code class="language-plaintext highlighter-rouge">sum(r, c, strs)</code> function: here we need to construct connections in our graph: first, we need to process each element in <code class="language-plaintext highlighter-rouge">strs</code> and create defaultdict <code class="language-plaintext highlighter-rouge">m</code>: what cells we need to take with which weights. Complexity is <code class="language-plaintext highlighter-rouge">O(WHE) &lt; O(W^2H^2)</code>, where <code class="language-plaintext highlighter-rouge">E</code> again is number of edges in our graph.</li>
</ol>

<h4 id="complexity">Complexity</h4>
<p>Space complexity is <code class="language-plaintext highlighter-rouge">O(WHE) &lt; O(W^2H^2)</code>, time complexities explained previously.</p>

<h4 id="code">Code</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Excel</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">matrix</span><span class="o">=</span><span class="p">[[{</span><span class="s">"val"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s">"E"</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">-</span> <span class="mi">64</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">H</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="mi">65</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"val"</span><span class="p">:</span><span class="n">v</span><span class="p">,</span> <span class="s">"E"</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="mi">65</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cell</span><span class="p">[</span><span class="s">"E"</span><span class="p">]:</span> <span class="k">return</span> <span class="n">cell</span><span class="p">[</span><span class="s">"val"</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">cell</span><span class="p">[</span><span class="s">"E"</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">65</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cell</span><span class="p">[</span><span class="s">"E"</span><span class="p">]])</span>

    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">strs</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strs</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)</span>
            <span class="n">i1</span><span class="p">,</span> <span class="n">j1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">ord</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">65</span>
            <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">j2</span> <span class="o">=</span> <span class="n">j1</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="nb">ord</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">65</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">matrix</span><span class="p">[</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="mi">65</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"val"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s">"E"</span><span class="p">:</span><span class="n">m</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</code></pre></div></div>


  </div><a class="u-url" href="/leetcode/0631.html" hidden></a>
</article>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Dmitry Babichev</li>
          <li><a class="u-email" href="mailto:dimitry008@gmail.com">dimitry008@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>