<!DOCTYPE html>
<html lang="en"><head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Leetcode 1825. Finding MK Average | Dmitry Babichev’s webpage</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Leetcode 1825. Finding MK Average" />
<meta name="author" content="Dmitry Babichev" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Problem statement" />
<meta property="og:description" content="Problem statement" />
<meta property="og:site_name" content="Dmitry Babichev’s webpage" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-14T19:00:50+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Leetcode 1825. Finding MK Average" />
<script type="application/ld+json">
{"url":"/leetcode/1825.html","@type":"BlogPosting","headline":"Leetcode 1825. Finding MK Average","dateModified":"2021-08-14T19:00:50+02:00","datePublished":"2021-08-14T19:00:50+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"/leetcode/1825.html"},"author":{"@type":"Person","name":"Dmitry Babichev"},"description":"Problem statement","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Dmitry Babichev's webpage" />
    






  
  
</head>

    
    <!-- for mathjax support -->
    
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Dmitry Babichev&#39;s webpage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/leetcode%20problems/">Leetcode problems</a><a class="page-link" href="/coding%20ideas/">Patterns</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <span>[
  
    
    <a href="/tag/heap"><code class="highligher-rouge"><nobr>heap</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/bst"><code class="highligher-rouge"><nobr>bst</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/queue"><code class="highligher-rouge"><nobr>queue</nobr></code>&nbsp;</a>
  
]</span>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Leetcode 1825. Finding MK Average</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-08-14T19:00:50+02:00" itemprop="datePublished">
        Aug 14, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h4 id="problem-statement">Problem statement</h4>

<p><a href="https://leetcode.com/problems/finding-mk-average/"> <font color="blue">https://leetcode.com/problems/finding-mk-average/</font></a></p>

<h4 id="solution">Solution</h4>
<p>The idea is similar to problem <strong>480. Sliding Window Median</strong>, here we also have sliding window, but we need to find not median, but some other statistics: sum of some middle elements in sorted window. Imagine for the purpose of example that <code class="language-plaintext highlighter-rouge">m = 7</code> and <code class="language-plaintext highlighter-rouge">k = 2</code>. Then we have widow of size <code class="language-plaintext highlighter-rouge">7</code>: <code class="language-plaintext highlighter-rouge">a1 &lt; a2 &lt; a3 &lt; a4 &lt; a5 &lt; a6 &lt; a7</code> and we need to evaluate the sum of <code class="language-plaintext highlighter-rouge">3</code> numbers <code class="language-plaintext highlighter-rouge">a3 + a4 + a5</code>. Let us solve two problems: evaluate <code class="language-plaintext highlighter-rouge">a1 + a2 + a3 + a4 + a5</code> and then substitute <code class="language-plaintext highlighter-rouge">a1 + a2</code>. How we are going to evaluate sum <code class="language-plaintext highlighter-rouge">a1 + a2</code> for example?</p>

<p>The idea is to keep <code class="language-plaintext highlighter-rouge">2</code> heaps: one for smallest <code class="language-plaintext highlighter-rouge">2</code> numbers in sliding window and another is for the <code class="language-plaintext highlighter-rouge">5</code> biggest numbers. We do it in very similar way as problem <strong>480</strong>, however we need to also evaluate sums. The trick is to use lazy deletion from heap, that is sometimes it happen, that there are some old elements in our window we need to be deleted later. If you know what is lazy deletion from heap, I think you got the idea, if not, please google it. The difficult part is how to update sum in heap as well, we need to do it carefully, because we have lazy updates, we need to make sure when we add or delete element, that it is element which will not be lazy update.</p>

<p>Finally, we need to solve two separate problems: one for parts with sizes <code class="language-plaintext highlighter-rouge">2 vs 5</code> and another with sizes <code class="language-plaintext highlighter-rouge">5 vs 2</code>. Also I use trick where I fill heap with zeroes at first, so no need to check case when we do not have enough elements it parts.</p>

<h4 id="complexity">Complexity</h4>
<p>Time complexity is <code class="language-plaintext highlighter-rouge">O(n log n)</code>, where <code class="language-plaintext highlighter-rouge">n</code> is total number of calls of <code class="language-plaintext highlighter-rouge">addElement</code>. Space complexity is <code class="language-plaintext highlighter-rouge">O(n)</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class MKAverage:
    def __init__(self, m: int, k: int):
        self.m, self.k = m, k
        self.arr = [0]*m
        self.lh1, self.rh1 = self.heap_init(m, k)
        self.lh2, self.rh2 = self.heap_init(m, m - k)
        self.score = 0
        
    def heap_init(self, p1, p2):
        h1 = [(0, i) for i in range(p1-p2, p1)]
        h2 = [(0, i) for i in range(p1-p2)]
        heapq.heapify(h1)
        heapq.heapify(h2)
        return (h1, h2)
        
    def update(self, lh, rh, m, k, num):
        score, T = 0, len(self.arr)
        if num &gt; rh[0][0]:
            heappush(rh, (num, T))        
            if self.arr[T - m] &lt;= rh[0][0]:
                if rh[0][1] &gt;= T - m: score += rh[0][0]
                score -= self.arr[T - m]
                heappush(lh, (-rh[0][0], rh[0][1]))
                heappop(rh)
        else:
            heappush(lh, (-num, T))       
            score += num
            if self.arr[T - m] &gt;= rh[0][0]: 
                heappush(rh, (-lh[0][0], lh[0][1]))
                q = heappop(lh)
                score += q[0]
            else:
                score -= self.arr[T - m]

        while lh and lh[0][1] &lt;= T - m: heappop(lh)  # lazy-deletion
        while rh and rh[0][1] &lt;= T - m: heappop(rh)  # lazy-deletion
        return score
        
    def addElement(self, num):
        t1 = self.update(self.lh1, self.rh1, self.m, self.k, num)
        t2 = self.update(self.lh2, self.rh2, self.m, self.m - self.k, num)
        self.arr.append(num)
        self.score += (t2 - t1)
    
    def calculateMKAverage(self):
        if len(self.arr) &lt; 2*self.m: return -1
        return self.score//(self.m - 2*self.k)
</code></pre></div></div>

<p>If you have any questions, feel free to ask. If you like solution and explanations, please <strong>Upvote!</strong></p>

  </div><a class="u-url" href="/leetcode/1825.html" hidden></a>
</article>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Dmitry Babichev</li>
          <li><a class="u-email" href="mailto:dimitry008@gmail.com">dimitry008@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>